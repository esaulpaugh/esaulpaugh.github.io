<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Headlong Encode Demo</title>
    <script src="https://cjrtnc.leaningtech.com/4.2/loader.js"></script>
</head>
<body>
<h1>Headlong Encode Demo</h1>
<input id="sigInput" type="text" placeholder='Signature like foo(int32,bool)...' style="width: 400px;" />
<input id="argsInput" type="text" placeholder='Arguments...' style="width: 400px;" />
<button id="gogoBtn">Encode</button>
<pre id="output"></pre>
<pre id="output2"></pre>

<script type="module">
    async function main() {
      const output = document.getElementById("output");
      const sigBox = document.getElementById("sigInput");
      const argsBox = document.getElementById("argsInput");
      const gogo = document.getElementById("gogoBtn");

      output.textContent = "Loading...";

      await cheerpjInit();
      const cjHeadlong = await cheerpjRunLibrary("/app/headlong-13.3.2-SNAPSHOT.jar");
      const FunctionClass = await cjHeadlong.com.esaulpaugh.headlong.abi.Function;

      output.textContent = "Ready. Enter args and press Encode.";

      gogo.onclick = async () => {
          output.textContent = "Encoding...";

          try {
            const fn = await new FunctionClass(sigBox.value);
            let args = JSON.parse("[" + argsBox.value + "]");

            const byteBuffer = await fn.encodeCallWithArgs(...args);
            output.textContent = byteBuffer ? "byteBuffer" : "null"

            const Strings = await cjHeadlong.com.esaulpaugh.headlong.util.Strings;
            const hex = await Strings.encode(byteBuffer);

            output.textContent = "Calldata hex:\n" + hex;
            output2.textContent = await fn.toString();
          } catch (e) {
            output.textContent = "Error: " + e;
            console.error(e);
          }
      };
    }

    main();
</script>
</body>
</html>
